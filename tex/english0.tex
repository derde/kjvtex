% !TeX document-id = {7879a0e9-c3ab-473f-99fc-635c7bcf5210}
% !TEX encoding = UTF-8 Unicode
% !TEX TS-program = XeLaTeX
\documentclass[8pt,twoside,openany,a4paper]{extbook}
%\usepackage[utf8]{inputenc}
% openany says chapters start on either page
% twoside says it's a real book
%\usepackage{microtype} % Improves spacing
\usepackage{fontspec}
% \usepackage{xunicode}
% \usepackage[margin=0.8in]{geometry}
%\usepackage[left=1.5cm,top=2.0cm,right=1.5cm,bottom=1.5cm,bindingoffset=0.5cm]{geometry}
%\geometry{papersize={7.444in,9.681in},total={4.8in,6.8in}}%
% 235mm x 165mm -
%\usepackage[utf8]{inputenc} % XeLaTeX is utf-8 or nuts
%\usepackage[T1]{fontenc}      % Don't do this - it causes pdf fonts not to happen
%\usepackage{paracol}
\setlength{\headsep}{0.0em}
\usepackage{lettrine}
\usepackage[bf,sf,center]{titlesec} % Required for modifying section titles -   bold, sans-serif, centered
\usepackage{fancyhdr}
\usepackage{needspace}
\usepackage[english]{babel}
% Grid sets rigid baseline and glue lengths to keep register-true - front and back pages aligned
\usepackage[fontsize=10.0pt,baseline=10.5pt]{grid}%
% Bottom border is 0.7 instead of 1.0, because we're not using the footer, and it's hard to turn off
%\usepackage[left=0.7cm,top=1.0cm,right=0.7cm,bottom=0.9cm,bindingoffset=0.0cm,headheight=5mm]{geometry}%
\usepackage[left=7mm,top=10mm,right=7mm,bottom=7mm,bindingoffset=0.0cm,headheight=5mm]{geometry}%
\geometry{papersize={148mm,210mm}}%
\usepackage[absolute,overlay]{textpos}
\TPGrid[0mm,14mm]{26}{66}% defines tiny box down right hand margin for book name - see textblock below
%\geometry{papersize={118mm,180mm}}%
% 0.3528pt/mm ... 334pt,510pt
%\usepackage[grid]{mymulticol}
\usepackage[grid]{multicol}
\setlength{\columnsep}{1.0em}
\setlength{\premulticols}{0\baselineskip}
\setlength{\postmulticols}{0\baselineskip}
\setlength{\multicolsep}{0\baselineskip}
\setlength{\emergencystretch}{0\baselineskip}
%\premulticols = 50pt
%\postmulticols= 20pt
%\multicolsep = 12pt plus 4pt minus 3pt
%
%This complains about initex being required ... 
%\begin{hyphenrules}{afrikaans}\include{hyph-af}\end{hyphenrules}
%\usepackage{etoolbox}
%\usepackage{xltxtra}
%\usepackage{setspace}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\setulmarginsandblock{2cm}{2cm}{*}
%\setlrmarginsandblock{2cm}{2cm}{*}
%\checkandfixthelayout
%%%%%%%%%%%%%
%Nice spacing, but not grid-like:
\setlength{\parindent}{0.5em}
%\setlength{\parskip}{0cm plus4mm minus1pt}
\fancypagestyle{noheadings}{%
    \fancyhead[EL]{} % hush
    \fancyhead[ER]{} % hush
    \fancyhead[OL]{} % hush
    \fancyhead[C]{} % hush
    \fancyhead[OR]{} % hush
}
\pagestyle{fancy}
\fancyhf{}
% register true is way better ...
%\fancyhead[L]{\textsf{\leftmark}} % Top left header
%\fancyhead[EL]{ - \em\textsf{\rightmark} - } % Top left header
%\fancyhead[ER]{\begin{textblock}{1}(0,\mybookindex)\hfill\rule[0em]{4mm}{3mm}\end{textblock}}% This is the chapter marker block
\fancyhead[ER]{}% This is the chapter marker block
\def\mybookname{GEN}
\def\mybookindex{0}
\fancyhead[OL]{\begin{textblock}{1}(25,\mybookindex)\hfill\rule[0em]{4mm}{4mm}\end{textblock}}% This is the chapter marker block
\fancyhead[OR]{\textbf{\textsf{--- \leftmark}}}% Top right header
\fancyhead[EL]{\textbf{\textsf{--- \rightmark}}}% Top left header - leading dash is to discourage accidental reading of the heading
\fancyhead[C]{\textbf{\textsf{\thepage}}}% Center footer
\renewcommand{\headrulewidth}{0.0pt}% lines just amplify the skewness of skewly printed pages 
\renewcommand{\footrulewidth}{0.0pt}%
%\defaultfontfeatures{Scale=MatchLowercase}
\defaultfontfeatures{}
%\setromanfont[Numbers=Uppercase]{New Standard}
%\setromanfont[Numbers=Uppercase]{DejaVu Sans Condensed}
%\fontspec{Liberation Serif}              % (TimesNewRoman0)
%\setmainfont[Numbers=Uppercase]{Liberation Serif} % 1046 pages
%% New Standard ... but you need fontforge to add semicolon to Old Standar ...
%% % \def\myfontname{New Standard}
%% % \fontspec{\myfontname}
%% % \setmainfont[ItalicFont=Old Standard TT Italic]{\myfontname}% 1006 pages +2
%% CHARIS SIL:
\def\myfontname{Charis SIL}
\def\mystretch{0.85}
\def\invmystretch{1.17}
\fontspec{\myfontname}
\setmainfont[FakeBold=\invmystretch,FakeStretch=\mystretch,Scale=1.00]{\myfontname}% 1006 pages +2
\newfontfamily\myfootnotefont[FakeBold=\invmystretch,FakeStretch=\mystretch,Scale=0.80]{\myfontname} % Used for (synthetic) smallcaps
%\fontspec{Gentium Book Plus}\setmainfont[Numbers=Uppercase]{Gentium Book Plus}% 947 pages +2
% \fontspec[Scale=0.8]{Times New Roman}   % (TimesNewRoman1)
% map TimesNewRoman(0)/bx/sc (bold smallcaps) to Junicode(1)/m/sc (normal smallcaps of fake bold)
% \DeclareFontShape{EU1}{TimesNewRoman(0)}{m}{sc}{<->ssub * TimesNewRoman(1)/m/sc}{}

%\setmainfont[Numbers=Uppercase,Ligatures=TeX]{Times New Roman} % Times New Roman is pretty good 996 pages
%\setmainfont[Numbers=Uppercase,Ligatures=NoCommon]{Times New Roman} % Times New Roman is pretty good 996 pages
% \setmainfont[Numbers=Uppercase,Ligatures=TeX]{Latin Modern Roman}% Ligatures maybe?

%\setmainfont[Numbers=Uppercase]{New Standard} % 1046 pages
% \setmainfont[Numbers=Uppercase]{Latin Modern Roman}
% \setmonofont[Scale=0.90,Ligatures=NoCommon]{Courier New}
\newfontfamily\mysuperscriptfont[FakeBold=\invmystretch,FakeStretch=\mystretch,Scale=0.65]{DejaVu Sans Condensed}
% Line space = 12pt*4 = 48 , Height = 4*8pt*n+4pt*n = 48pt = n*(24+4)pt=48
\newfontfamily\mybooktitlefont[FakeBold=\invmystretch,FakeStretch=\mystretch,Scale=2.80]{\myfontname}
% Chapter numbers would be a little bigger than two lines in double size, so scale them down a bit:
\newfontfamily\mychapterfont[FakeBold=\invmystretch,FakeStretch=\mystretch,Scale=0.90]{DejaVu Sans Condensed}
%\usepackage{fontspec}  
%\setmainfont[Ligatures=TeX]{Linux Libertine O}  
%\usepackage{metalogo,hyperref}  
%\usepackage{polyglossia, fontspec, xunicode}  
%\usepackage[parfill]{parskip}  
%\usepackage[series={A,B},noend,noledgroup]{reledmac}  
%\usepackage{reledpar}   
\usepackage{printlen}% provide \printlength command, and \rndprintlength
%
%
%
% \pretolerance is used to tell the processor when there is too much space between words, and an attempt should be made to hyphenate some of them; 
% \tolerance is used to indicate when there is too much space even after breaking words.
% If we want to avoid breaking words, and avoid having too long lines, we have to use a very high value for 
% \pretoletance. An “infinite” tolerance is represented by the value 10000.
\pretolerance=2500
\let\textquotedbl="
\let\quotedblbase="
%
%% % due to a bug in memoir (as of 2015/8/24) [twoside] option will give a spurious space
%% % this will be fixed as memoir gets updated
%% % \counterwithin{section}{chapter}
%% % \counterwithin{chapter}{verse}
%% \chapterstyle{section}
%% \newcommand*{\thebooktitle}{}
%% \renewcommand*{\printbooktitle}[1]{\gdef\thebooktitle{#1}\booktitlefont #1}
%% \renewcommand*{\printchapternum}{\chapnumfot\thebooktitle\ \thechapter}
%% \renewcommand{\thesection}{\arabic{section}}
%% \newcommand{\marginbox}[1]{%
%%    \parbox[t][0pt]{0em}{\bfseries\huge\raggedleft\leavevmode #1}}
%%  \newcommand{\marginhead}[1]{%
%%    {\llap{\marginbox{#1}\kern1em}}}
%%  \setsecindent{0em}
%%  \setaftersecskip{0em}
%%  \setsecheadstyle{\marginhead}
\renewcommand{\verse}[1]{\raisebox{3pt}[0pt]{\mysuperscriptfont\textbf{#1}\hspace{0.1em}}}%3 points up, count height as 0 points, kern at end
%\newcommand{\biblpagetitles}[2]{\lock{#1}{#2}}%
\newcommand{\bibltwocolumn}{\begin{multicols}{2}}%
\newcommand{\biblonecolumn}{\end{multicols}}%
%\renewcommand{\bibltwocolumn}{\par}%
%\renewcommand{\biblonecolumn}{\par}%
\newcommand{\biblendbook}[2]{\biblonecolumn\def\mybookindex{#2}}%
\newcommand{\biblnewsection}{\par\newpage%\thispagestyle{noheadings}
}%
\newcommand{\biblenddocument}{\biblonecolumn}%
%
%\newcommand{\biblbookheading}[1]{\needspace{7\baselineskip}\begin{center}\textbf{\mybooktitlefont\Huge {#1}}\end{center}\par\vspace{\baselineskip}\bibltwocolumn}%
% \strutsomelines:
% * The 1.3\baselineskip is necessary sinnce the large text has a big baseline
% * 0pt makes it invisible
% * 5\baselineskip means it covers 5 lines
\def\strutsomelines{\rule[-1\baselineskip]{0pt}{4.0\baselineskip}}%
% Heading for each book of the Bible: big text
\newcommand{\biblnewreference}[2]{\markboth{#1}{#1}\def\mybookindex{#2}}%
\newcommand{\biblendreference}[2]{\markboth{#1}{#1}\def\mybookindex{#2}}%
\newcommand{\biblbookheading}[1]{
\needspace{8\baselineskip}%
{\centering \textbf{\mybooktitlefont #1}\strut\strutsomelines\par} 
\bibltwocolumn}%
%\newcommand{\biblleftcolumn}[1]{\selectlanguage{#1}\widowpenalty=0\clubpenalty=0} % just make widows, because alignment is more important
%\newcommand{\biblrightcolumn}[1]{\switchcolumn\selectlanguage{#1}\widowpenalty=0\clubpenalty=0}%
%\newcommand{\bibldonecolumns}{\biblonecolumn}%
%\newcommand{\biblendchapter}{\vfill}%
%\newcommand{\biblnewchapter}[1]{\markboth{#1}{#1}}%
\newcommand{\markieset}{}%
\newcommand{\biblnewchapter}[1]{\renewcommand\markieset{\markboth{#1}{#1}}\iffalse\markright{#1}\fi}%
\newcommand{\biblendchapter}[2]{\iffalse\markright{#1}\fi\def\mybookindex{#2}}%
\newcommand{\biblnewbook}[3]{\iffalse\markboth{#1}{#1}\fi\def\mybookshort{#2}\def\mybookindex{#3}}%
%
%\newcommand{\biblchapter}[2]{\vspace{2cm}\needspace{3\baselineskip}}
%% %New book in separate paracol
%% \newcommand{\biblnewbook}[2]{\vspace{2cm}%
%% \begin{paracol}{2}%
%% \textbf{\Huge #1}%
%% \switchcolumn%
%% \textbf{\Huge #2}%
%% \end{paracol}\nopagebreak}%
%% \setlength{\abnormalparskip{1pt}}
%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\bibldropcapschapter}[1]{\needspace{0.5\baselineskip}
\lettrine[lines=2, lraise=0.0, lhang=0.05, findent=3pt, nindent=0pt, loversize=0.0]{\textbf{\mychapterfont #1}}{}\iffalse\markieset\fi}%
% Work around lettrine bug with "Fpar" definition from https://tex.stackexchange.com/questions/369868/using-lettrine-with-short-paragraphs :
\def\biblsyntheticpar{\par}%
% Synthetic paragraph that should be used for verse 2, in case it is right net to verse 1 and the dropcaps chapter number
\def\biblsyntheticparii{\hfil\vadjust{\vskip\parskip}\break\indent}%
% Don't warn for slightly overfull hboxen
\hfuzz=2pt%
% All our vertical stuff is bad for now
\vbadness=10000%
\vfuzz=0pt%
% Try to avoid stranded chapter header at the bottom of the page (this doesn't work)
%\widowpenalty=0%
%\clubpenalty=0%
% Pretty separater
%\setlength{\columnseprule}{0.3pt}%
\setlength{\columnseprule}{0.0pt}%
%\setlength{\headsep}{3pt}%
\begin{document}
%\tableofcontents
%\raggedright% this is nice in that it makes the central margin seem bigger, but the lack of hypenation adds 5% pages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\addfontfeature{LetterSpace=-2 plus 2 minus 1}% This is around 16 pages longer
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Kerning adjustment: big deal page-count affecter
\addfontfeature{LetterSpace=0 plus 0 minus 2}% The 3em space is what a good font design uses ... and we trample it
% Big deal don't hypenate rule: we would save pages by hypenating, but it's ugly
\hyphenpenalty=1300
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%k
\mainmatter%
\thispagestyle{noheadings}%
%\fontsize{10}{10}\selectfont%
\null
\strutsomelines\par
\begin{center}%
\textbf{\mybooktitlefont{King James Bible}}
\par\vspace{7\baselineskip}\par
The fruit of the righteous is a tree of life;\par and he that winneth souls is wise.
\par\vspace{7\baselineskip}\par
And whosoever will, let him take the water of life freely.
\end{center}
\vfill
\par
Typesetting by \LaTeX{},
Font \makeatletter \f@family \makeatother\ \the\fontdimen6\font\the\font\ text,
scaled \mystretch / bold \invmystretch,
line spacing \the\baselineskip
\par
{\uselengthunit{mm}Paper size \rndprintlength{\pdfpagewidth} $ \times $ \rndprintlength{\pdfpageheight}}
\par
Source repository: https://github.com/derde/kjvtex
\par
Source text TEXT-PCE-127.txt, md5sum: d6176dd776234eeaf0944dd0cac24bef
\par
No headings, verses continue on same line, justified
\par
\vspace{2\baselineskip}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\shipout\null\stepcounter{page}%this page intentionally left blank
\include{english}% Load main content
\biblenddocument%
%%\bigskip%%\ldots
\end{document}

